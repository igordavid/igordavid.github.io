---
layout: post
status: publish
published: true
title: Aws Opsworks - modify instance hostname FQDN
author:
author_login: admin
author_email: igord@bra.in.rs
wordpress_id: 97
wordpress_url: http://www.cloudhowto.org/?p=97
date: '2014-09-16 15:31:51 +0100'
date_gmt: '2014-09-16 15:31:51 +0100'
categories:
- OpsWorks
tags: []
comments: []
---
<p>By default, if you want to setup FQDN for AWS Opsworks instances, you will have problem because in AWS Management console you can't put "your.domain.com", since "dots" (.) are forbidden. This is most likely done because Opsworks wants to control FQDN by itself.</p>
<p>However, most likely you will want to setup your own FQDN for an instance (for example if you are running mail server or similar). </p>
<p>In order to modify instance FQDN, one way is to modify template file which is used for setting up /etc/hosts file:</p>
<p>https://github.com/aws/opsworks-cookbooks/blob/release-chef-11.10/opsworks_stack_state_sync/templates/default/hosts.erb</p>
<p>So basically, in your own custom cookbook repository you need to create exact same directory and template file:</p>
<p>opsworks_stack_state_sync/templates/default/hosts.erb</p>
<p>Now, you can modify that template file to put your domain name, e.g.:</p>
<p><code><br />
# This file was generated by OpsWorks<br />
# # any manual changes will be removed on the next update.<br />
# # The following lines are desirable for IPv6 capable hosts<br />
 ::1 ip6-localhost ip6-loopback<br />
 fe00::0 ip6-localnet<br />
 ff00::0 ip6-mcastprefix<br />
 ff02::1 ip6-allnodes<br />
 ff02::2 ip6-allrouters<br />
 ff02::3 ip6-allhosts<br />
# # OpsWorks Layer State<br />
 127.0.0.1 localhost.localdomain localhost<br />
 127.0.1.1 <%= @localhost_name %>.localdomain <%= @localhost_name %> <%= @localhost_name %>.cloudhowto.org<br />
 <% @nodes.each do |node| -%><br />
 <% if node.attributes.attribute?(:private_ip) && node.attributes.private_ip && Resolv.getaddress(node.attributes.private_ip) -%><br />
 <%= node.attributes.private_ip %> <%= node.name %> <%= node.hostname %>.cloudhowto.org<br />
 <% else -%><br />
 <%= "# Unable to resolve IP '#{node.attributes.private_ip}' for hostname '#{node.name}'" %><br />
 <% end -%><br />
 <% if node.attributes.attribute?(:ip) && node.attributes.ip && Resolv.getaddress(node.attributes.ip) -%><br />
 <%= node.attributes.ip %> <%= node.name %>-ext <%= node.hostname %>-ext.cloudhowto.org<br />
 <% else -%><br />
 <%= "# Unable to resolve IP '#{node.attributes.ip}' for hostname '#{node.name}'" %><br />
 <% end -%><br />
 <% end -%><br />
</code></p>
<p>After this, you can execute your custom cookbook recipe by:</p>
<p>opsworks_stack_state_sync::hosts</p>
<p>More useful info:</p>
<p><a href="http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-template-override.html" title="Override default template Opsworks">http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-template-override.html</a></p>
